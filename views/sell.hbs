<link rel='stylesheet' href="/swiper/dist/css/swiper.min.css" />
{{#extend "stylesheets"}}
  <style>
    body {
      background: #eee;
      font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
      font-size: 14px;
      color: #000;
      margin: 0;
      padding: 0;
    }

    .swiper-container {
      width: 100%;
      height: 300px;
      background: #fff;
    }

    .swiper-slide {
      text-align: center;
      font-size: 18px;
      background: #fff;
      /* Center slide text vertically */
      display: -webkit-box;
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      -webkit-justify-content: center;
      justify-content: center;
      -webkit-box-align: center;
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
    }
  </style>
{{/extend}}
<div class="swiper-container">
  <div class="swiper-wrapper">

  </div>
  <!-- Add Pagination -->
  <div class="swiper-pagination"></div>
</div>
<!-- <button id="btnSelectImg">选择图片</button> -->
<!-- <div style="background:#fff;margin-top:2em;"> -->
<div class="container-fluid" style="background:#fff;margin-top:10px;height:100%;">
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">作者</span>
          <input placeholder="请输入作者名称" class="form-control" type="text" id="txtAuthorName"/>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">画名</span>
          <input placeholder="请输入画名" class="form-control" type="text" id="txtImgName"/>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">画种</span>
        <!-- Split button -->
        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="border-radius:0;width:100%;text-align:right;">
            <span id="typeTitle">选择画种</span>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" id="ulType" aria-labelledby="dropdownMenu1">
            <li><a href="#">山水画</a></li>
            <li><a href="#">人物画</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">题材</span>
        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="border-radius:0;width:100%;text-align:right;">
            <span id="catalogTitle">选择题材</span>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" id="ulCatalog" aria-labelledby="dropdownMenu2">
            <li><a href="#">题材1</a></li>
            <li><a href="#">题材2</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">尺寸</span>
          <input placeholder="宽" class="form-control" type="text" id="txtImgWidth" style="width:35%;float:none;text-align:center;"/> x <input placeholder="高" style="text-align:center;width:35%;border-radius:0;float:none;" class="form-control" type="text" id="txtImgHeight"/>
          <span style="font-size:0.8em;color:gray;">（单位:cm）</span>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">底价</span>
          <input placeholder="请输入底价" class="form-control" type="text" id="txtImgPrice"/>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12">
      <div class="input-group">
        <span class="input-group-addon">备注</span>
          <input placeholder="请输入备注" class="form-control" type="text" id="txtDesc"/>
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:5px;">
    <div class="col-xs-12" style="display:flex;flex-direction:row;align-items:center;justify-content:center;">
      <button id="btnSave" type="button" class="btn btn-primary">提 交</button>
    </div>
  </div>
</div>
{{#extend "scripts"}}
  <script type="text/javascript" src="/swiper/dist/js/swiper.min.js"></script>
  <script>
    $(function() {
      var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        paginationClickable: true,
        spaceBetween: 30,
      });

      $("#ulType li").on('click', function(){
        // alert($("#typeTitle").text());
        $("#typeTitle").text($(this).text());
      })

      $("#ulCatalog li").on('click', function(){
        // alert($("#typeTitle").text());
        $("#catalogTitle").text($(this).text());
      })
    })
    wx.ready(function() {
      var localIds = [];
      var serverIds = [];
      $("#btnSelectImg").click(function() {
        wx.chooseImage({
          count: 9,
          success: function(res) {
            var Ids = res.localIds;
            localIds.push(Ids);
            var d = $(".swiper-wrapper");
            for(var i = 0; i <Ids.length; i++){
              d.append('<div class="swiper-slide"><img src="'+Ids[i]+'"  /></div>');
            }
          }
        });
      });
      $("#btnSave").click(function() {
        syncUpload(localIds);
      });

      var syncUpload = function(localIds){
        var localId = localIds.pop();
        wx.uploadImage({
          localId: localId,
          success: function(res){
            var serverId = res.serverId;
            serverIds.push(serverId);
            if(localIds.length > 0){
              syncUpload(localIds);
            }else{
              $.ajax({
                url:'/saleDetail/saveItem',
                type:'POST',
                data:{name:$("#txtImgName").val(), author:$("#txtAuthorName").val(), width:$("#txtImgWidth").val(),height:$("#txtImgWidth").val(),comment:$("#txtDesc").val(),type:$("#typeTitle").text(),price:$("#txtImgPrice").val(),images:serverIds,catalog:$("#catalogTitle").text()},
                success: function(data){
                },
                error:function(req, status, err){
                },
                complete:function(res,status){
                  console.log(res);
                }
              })
            }
          }
        })
      }
    });
  </script>
{{/extend}}
